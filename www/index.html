<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tone.js -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            transition: background-color 0.5s ease;
        }

        .mode-btn.active { 
            background-color: #4b5563; 
            color: white; 
            font-weight: 600; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); 
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .toggle-switch {
            width: 2.5rem;
            height: 1.25rem;
            background-color: #4b5563;
            position: relative;
            cursor: pointer;
            border-radius: 9999px;
            transition: background-color 0.2s ease-in-out;
        }
        .toggle-switch.active {
            background-color: #0ea5e9;
        }
        .toggle-switch-thumb {
            width: 1rem;
            height: 1rem;
            background-color: #e2e8f0;
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            border-radius: 9999px;
            transition: transform 0.2s ease-in-out;
        }
        .toggle-switch.active .toggle-switch-thumb {
            transform: translateX(1.25rem);
            background-color: white;
        }
        
        .icon-transition {
            transition: opacity 0.3s ease;
        }

    </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen p-4" data-mode="focus">
    <div class="fixed top-6 right-6 z-50">
        <!-- Settings Button with icon toggle -->
        <button id="settingsBtn" class="bg-transparent text-gray-400 hover:text-white transition-colors duration-200 focus:outline-none rounded-full p-2" aria-label="Settings">
            <svg id="settingsIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings icon-transition">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.39a2 2 0 0 0 .73 2.73l.15.08a2 2 0 0 1 1 1.73v.53a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2-2.18v.44a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.73v-.53a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 2.18v-.44a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg id="closeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x hidden icon-transition">
                <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
        </button>
    </div>

    <div class="container bg-slate-900 p-6 md:p-8 rounded-3xl shadow-2xl w-full max-w-md mx-auto relative">
        <!-- Timer Modes -->
        <div id="timerModes" class="mode-container bg-slate-800 p-1 rounded-xl flex justify-between gap-1 mb-8 shadow-inner">
            <button class="mode-btn text-slate-400 font-semibold py-2 px-6 rounded-lg text-sm md:text-base transition-colors duration-200 focus:outline-none" data-mode="focus">Focus</button>
            <button class="mode-btn text-slate-400 font-semibold py-2 px-6 rounded-lg text-sm md:text-base transition-colors duration-200 hover:text-white" data-mode="short-break">Short Break</button>
            <button class="mode-btn text-slate-400 font-semibold py-2 px-6 rounded-lg text-sm md:text-base transition-colors duration-200 hover:text-white" data-mode="long-break">Long Break</button>
        </div>

        <!-- Timer Display -->
        <div id="timerDisplay" class="text-7xl md:text-8xl font-bold text-center mb-4 md:mb-6 tracking-wide">25:00</div>
        <div id="sessionInfo" class="text-lg text-center text-slate-400 mb-8 md:mb-10 flex items-center justify-center gap-2">
            <div class="w-2 h-2 bg-red-400 rounded-full" id="sessionDot"></div>
            <span>Focus Session</span>
        </div>

        <!-- Main Action Buttons -->
        <div class="flex items-center justify-center gap-4">
            <button id="mainBtn" class="w-full max-w-sm font-bold py-4 px-8 text-2xl rounded-full transition-colors duration-300 focus:outline-none border-4 border-white text-white">
                <span id="mainBtnContent" class="flex items-center justify-center gap-2">
                    <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    <span>Start</span>
                </span>
            </button>
            <button id="resetBtn" class="bg-transparent text-gray-400 hover:text-white transition-colors duration-200 p-3 rounded-full focus:outline-none">
                <!-- NEW RESET ICON -->
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24">
                  <path d="M22.719 12A10.719 10.719 0 0 1 1.28 12h.838a9.916 9.916 0 1 0 1.373-5H8v1H2V2h1v4.2A10.71 10.71 0 0 1 22.719 12z"/>
                  <path fill="none" d="M0 0h24v24H0z"/>
                </svg>
            </button>
        </div>
        
        <!-- Settings Panel (Initially Hidden) -->
        <div id="settingsPanel" class="bg-slate-800 p-6 rounded-2xl shadow-inner mt-8 hidden">
            <h2 class="text-lg font-bold mb-4 text-slate-200">Custom Timer Settings</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="flex flex-col">
                    <label for="focusTime" class="text-sm text-slate-400 mb-1">Focus (min)</label>
                    <input type="number" id="focusTime" value="25" min="1" class="bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
                <div class="flex flex-col">
                    <label for="shortBreakTime" class="text-sm text-slate-400 mb-1">Short Break (min)</label>
                    <input type="number" id="shortBreakTime" value="5" min="1" class="bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
                <div class="flex flex-col">
                    <label for="longBreakTime" class="text-sm text-slate-400 mb-1">Long Break (min)</label>
                    <input type="number" id="longBreakTime" value="15" min="1" class="bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-lg font-bold mb-4 text-slate-200">Binaural Beats</h3>
                <div class="flex items-center justify-between">
                    <label for="binauralBeatToggle" class="text-slate-400">Enable during sessions</label>
                    <div id="binauralBeatToggle" class="toggle-switch">
                        <div class="toggle-switch-thumb"></div>
                    </div>
                </div>
                <div id="binauralBeatOptions" class="mt-4 hidden">
                    <label for="binauralBeatSelect" class="text-sm text-slate-400 mb-1 block">Beat Type</label>
                    <select id="binauralBeatSelect" class="w-full bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <option value="focus">Focus (10 Hz)</option>
                        <option value="meditation">Meditation (8 Hz)</option>
                        <option value="sleep">Sleep (4 Hz)</option>
                    </select>
                </div>
            </div>
            
            <button id="applyBtn" class="mt-6 w-full bg-sky-600 text-white font-semibold py-3 rounded-lg hover:bg-sky-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-sky-500/50">Apply Settings</button>
        </div>
    </div>
    
    <!-- Custom Modal for Messages -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <p id="modalMessage" class="text-lg mb-4 text-slate-200"></p>
            <button id="modalCloseBtn" class="bg-sky-600 text-white py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors duration-200">OK</button>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const body = document.body;
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsIcon = document.getElementById('settingsIcon');
        const closeIcon = document.getElementById('closeIcon');
        const settingsPanel = document.getElementById('settingsPanel');
        const timerDisplay = document.getElementById('timerDisplay');
        const sessionInfo = document.getElementById('sessionInfo');
        const sessionDot = document.getElementById('sessionDot');
        const mainBtn = document.getElementById('mainBtn');
        const mainBtnContent = document.getElementById('mainBtnContent');
        const resetBtn = document.getElementById('resetBtn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const focusTimeInput = document.getElementById('focusTime');
        const shortBreakTimeInput = document.getElementById('shortBreakTime');
        const longBreakTimeInput = document.getElementById('longBreakTime');
        const applyBtn = document.getElementById('applyBtn');
        const messageModal = document.getElementById('messageModal');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const binauralBeatToggle = document.getElementById('binauralBeatToggle');
        const binauralBeatOptions = document.getElementById('binauralBeatOptions');
        const binauralBeatSelect = document.getElementById('binauralBeatSelect');
        const modeContainer = document.getElementById('timerModes');
        
        // Timer Variables
        let timer;
        let isRunning = false;
        let timeLeft;
        let currentMode = 'focus';
        let pomodoroDurations = {
            focus: 25 * 60,
            'short-break': 5 * 60,
            'long-break': 15 * 60
        };

        // Audio Setup (using Tone.js)
        let userInteracted = false;
        const endSessionSynth = new Tone.Synth().toDestination();
        let binauralBeatPlayer = null;
        
        const binauralBeats = {
            focus: { base: 440, beat: 10, volume: -15 }, 
            meditation: { base: 440, beat: 8, volume: -15 }, 
            sleep: { base: 440, beat: 4, volume: -15 } 
        };

        // User must interact with the page to start audio
        document.addEventListener('click', () => {
            if (!userInteracted) {
                userInteracted = true;
                Tone.start();
            }
        });

        function startBinauralBeat() {
            // Check if toggle is active AND user has interacted
            if (!binauralBeatToggle.classList.contains('active') || !userInteracted) {
                 return;
            }

            // Stop any existing beat before starting a new one
            if (binauralBeatPlayer) {
                stopBinauralBeat();
            }
            
            const beatType = binauralBeatSelect.value;
            const beatConfig = binauralBeats[beatType];
            const freq1 = beatConfig.base - (beatConfig.beat / 2);
            const freq2 = beatConfig.base + (beatConfig.beat / 2);
            const volume = beatConfig.volume;

            // Create a GainNode to control overall volume and connect to destination
            const gain = new Tone.Gain(Tone.dbToGain(volume)).toDestination();
            
            // Create two Panners for stereo separation
            const panner1 = new Tone.Panner(-1).connect(gain); // Hard left
            const panner2 = new Tone.Panner(1).connect(gain);  // Hard right
            
            // Create two Oscillators with slightly different frequencies
            const osc1 = new Tone.Oscillator(freq1, "sine").connect(panner1);
            const osc2 = new Tone.Oscillator(freq2, "sine").connect(panner2);

            binauralBeatPlayer = { osc1, osc2, gain, panner1, panner2 };
            
            // Start both oscillators
            osc1.start();
            osc2.start();
        }

        function stopBinauralBeat() {
            if (binauralBeatPlayer) {
                binauralBeatPlayer.osc1.stop();
                binauralBeatPlayer.osc2.stop();
                // Dispose of all nodes to prevent memory leaks and sound artifacts
                binauralBeatPlayer.osc1.dispose();
                binauralBeatPlayer.osc2.dispose();
                binauralBeatPlayer.panner1.dispose();
                binauralBeatPlayer.panner2.dispose();
                binauralBeatPlayer.gain.dispose();
                binauralBeatPlayer = null;
            }
        }

        function showMessageModal(message) {
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }

        modalCloseBtn.addEventListener('click', () => {
            messageModal.style.display = 'none';
        });

        function updateDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function updateButtonState(state) {
            mainBtn.className = 'w-full max-w-sm font-bold py-4 px-8 text-2xl rounded-full transition-colors duration-300 focus:outline-none border-4 border-white text-white';
            mainBtnContent.innerHTML = '';
            
            if (state === 'running') {
                mainBtnContent.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pause-circle"><circle cx="12" cy="12" r="10"/><line x1="10" x2="10" y1="15" y2="9"/><line x1="14" x2="14" y1="15" y2="9"/></svg>
                    <span>Pause</span>
                `;
            } else { // state === 'stopped' or 'paused'
                mainBtnContent.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    <span>Start</span>
                `;
            }

            let dotColor;
            if (currentMode === 'focus') { dotColor = 'bg-red-400'; }
            else if (currentMode === 'short-break') { dotColor = 'bg-teal-400'; }
            else { dotColor = 'bg-indigo-400'; }
            sessionDot.className = `w-2 h-2 rounded-full ${dotColor}`;
        }
        
        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            updateButtonState('running');
            startBinauralBeat(); 

            timer = setInterval(() => {
                timeLeft--;
                updateDisplay(timeLeft);

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    
                    if (userInteracted) {
                       endSessionSynth.triggerAttackRelease("C4", "8n");
                    }
                    
                    stopBinauralBeat(); 
                    
                    let nextMode;
                    if (currentMode === 'focus') { nextMode = 'short-break'; }
                    else if (currentMode === 'short-break') { nextMode = 'focus'; }
                    else { nextMode = 'focus'; }
                    switchMode(nextMode);
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timer);
            isRunning = false;
            stopBinauralBeat(); 
            updateButtonState('stopped');
        }

        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            stopBinauralBeat();
            updateButtonState('stopped');
            
            timeLeft = pomodoroDurations[currentMode];
            updateDisplay(timeLeft);
        }

        function switchMode(mode) {
            if (isRunning) {
                showMessageModal("Please stop or pause the timer before switching modes.");
                return;
            }

            modeBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
            
            currentMode = mode;
            modeContainer.setAttribute('data-mode', mode);
            resetTimer();
            sessionInfo.querySelector('span').textContent = `${mode.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')} Session`;
            
            let bgColorClass;
            if (mode === 'focus') { bgColorClass = 'bg-black'; }
            else if (mode === 'short-break') { bgColorClass = 'bg-teal-950'; }
            else { bgColorClass = 'bg-indigo-950'; }
            body.className = `text-white flex items-center justify-center min-h-screen p-4 ${bgColorClass}`;
            
            updateButtonState('stopped');
        }

        modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                switchMode(btn.dataset.mode);
            });
        });

        resetBtn.addEventListener('click', () => {
            resetTimer();
        });
        
        settingsBtn.addEventListener('click', () => {
            const isHidden = settingsPanel.classList.contains('hidden');
            if (isHidden) {
                settingsPanel.classList.remove('hidden');
                settingsIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
            } else {
                settingsPanel.classList.add('hidden');
                settingsIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }
        });

        binauralBeatToggle.addEventListener('click', () => {
            binauralBeatToggle.classList.toggle('active');
            const isActive = binauralBeatToggle.classList.contains('active');
            
            if (isActive) {
                binauralBeatOptions.classList.remove('hidden');
            } else {
                binauralBeatOptions.classList.add('hidden');
                stopBinauralBeat();
            }

            if (isRunning) {
                if (isActive) {
                    startBinauralBeat();
                } else {
                    stopBinauralBeat();
                }
            }
        });

        binauralBeatSelect.addEventListener('change', () => {
            if (isRunning && binauralBeatToggle.classList.contains('active')) {
                stopBinauralBeat(); // Stop the old beat
                startBinauralBeat(); // Start the new one
            }
        });
        
        applyBtn.addEventListener('click', () => {
            const newFocusTime = parseInt(focusTimeInput.value);
            const newShortBreakTime = parseInt(shortBreakTimeInput.value);
            const newLongBreakTime = parseInt(longBreakTimeInput.value);

            if (isNaN(newFocusTime) || isNaN(newShortBreakTime) || isNaN(newLongBreakTime) || newFocusTime < 1 || newShortBreakTime < 1 || newLongBreakTime < 1) {
                showMessageModal("All timer values must be valid numbers of at least 1 minute.");
                return;
            }

            pomodoroDurations.focus = newFocusTime * 60;
            pomodoroDurations['short-break'] = newShortBreakTime * 60;
            pomodoroDurations['long-break'] = newLongBreakTime * 60;

            resetTimer(); 
            settingsPanel.classList.add('hidden');
            settingsIcon.classList.remove('hidden');
            closeIcon.classList.add('hidden');
        });

        mainBtn.addEventListener('click', () => {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        });
        
        // Initialize the timer on page load
        timeLeft = pomodoroDurations[currentMode];
        updateDisplay(timeLeft);
        updateButtonState('stopped');
        document.querySelector(`.mode-btn[data-mode="${currentMode}"]`).classList.add('active');
    </script>
</body>
</html>
